<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<title>UTRADE</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<!-- Favicons -->
<link href="assets/img/UTRADE_ICON-removebg-preview.png" rel="icon">
<link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">
<!-- Google Fonts (You can keep only the fonts you use) -->
<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600|Nunito:400,600|Poppins:400,500,600,700" rel="stylesheet">
<!-- Vendor CSS Files -->
<link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
<link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
<!-- Template Main CSS File -->
<link href="assets/css/style.css" rel="stylesheet">
</head>

<style>
.symbol {
font-weight: bold;
}

.price, .change, .percentage-change {
font-weight: bold;
}

.positive-change {
color: #016e43;
}

.negative-change {
color: #c20404;
}

.dark-blue {
color: #003366;
}

.center-container1 {
display: flex;
justify-content: center;
align-items: center;
/* height: 70vh; */    /*----------------------------*/
margin-top: 5px;
}

main .container1 {
display: flex;
flex-wrap: wrap;
justify-content: space-between;
margin-top: 20px;
}

main .card1 {
width: 18rem;
transition: transform 0.2s; /* Add a smooth transition effect */
}
main .card1:hover {
transform: scale(1.05); /* Enlarge the card on hover */
}

.btn-container1 {
text-align: right;
margin-right: 30px;
}

.btn{
margin-right: 10px;
}

main {
text-align: center;
/* margin-top: 100px; */
}

.center-container1 {
margin: 0 auto;
}

.fa-regular {
font-size: 20px;
}

.image-small{
width: 25px;
border-radius: 10px;
}

.main-body{
margin-top: 75px;
}

.modal_1 {
position: fixed;
margin: auto;
width: 100%;
height: 100%;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
background-color: white; /* Adjust the background color as needed */
z-index: 1001; /* Ensure it's above the overlay */
display: none;
}

.modal-content {
text-align: center;
}

.next{
  margin-right: 30px;
}

</style>

<!-- ======= Header ======= -->
<header id="header" class="header fixed-top d-flex align-items-center">

<div class="d-flex align-items-center justify-content-between">
<a href="interests.html" class="logo d-flex align-items-center">
<img src="assets/img/logo.png" alt="logo" style="padding-left: 40px;">
</a>
</div><!-- End Logo -->

</header><!-- End Header -->

<!-- ======= main ======= -->
<main>
  <div class="modal-overlay" id="modalOverlay"></div>

  <!-- Modal -->
  <div class="modal modal_1" id="customModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2></h2>
      </div>
      <div class="modal-body">
        <!-- Add your content here -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary close-btn" onclick="closeModal()">Close</button>
      </div>
    </div>
  </div>

<!-- <div class="modal-dialog modal-dialog-scrollable modal" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true" style="display: none;">
<div class="modal-dialog">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title fs-5" id="staticBackdropLabel"></h2>
      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
    </div>
    <div class="modal-body">
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary close-btn" data-bs-dismiss="modal" onclick="closeModal()">Close</button>
    </div>
  </div>
</div>
</div> -->
<!-- end of modal Mohammed -->
<div class="main-body">
<div class="first">
  <h2>Choose your favorite stocks</h2>
  <div class="center-container center-container1">
      <div class="container container1" style="display: flex; justify-content: space-around;">


          <div class="card card1" style="width: 18rem;">
              <div class="card-body">
                  <h5 class="card-title">Software</h5>
                  <a href="#" class="btn btn-primary show-modal-btn" data-target="software">show all</a>
              </div>
          </div>


          <div class="card card1" style="width: 18rem;">
              <div class="card-body">
                  <h5 class="card-title">Hardware</h5>
                  <a href="#" class="btn btn-primary show-modal-btn" data-target="hardware">show all</a>
              </div>
          </div>

          <div class="card card1" style="width: 18rem;">
              <div class="card-body">
                  <h5 class="card-title">Security</h5>
                  <a href="#" class="btn btn-primary show-modal-btn" data-target="security">show all</a>
              </div>
          </div>

          <div class="card card1" style="width: 18rem;">
              <div class="card-body">
                  <h5 class="card-title">Telecommunication</h5>
                  <a href="#" class="btn btn-primary show-modal-btn" data-target="telecommunication">show all</a>
              </div>
          </div>

          <div class="card card1" style="width: 18rem;">
              <div class="card-body">
                  <h5 class="card-title">IT Services</h5>
                  <a href="#" class="btn btn-primary show-modal-btn" data-target="IT">show all</a>
              </div>
          </div>

          <div class="card card1" style="width: 18rem;">
              <div class="card-body">
                  <h5 class="card-title">Internet Services</h5>
                  <a href="#" class="btn btn-primary show-modal-btn" data-target="internet">show all</a>
              </div>
          </div>


      </div>
  </div>
  <!-- end of cards -->
</div>

<div class="btn-container btn-container1">
  <a href="prtfolio.html" class="btn btn-primary next" style="padding: 6px 26px 6px 26px;">Next</a>
</div>

</div>
</main>

<script>
const showModalBtns = document.querySelectorAll('.show-modal-btn');
const modal = document.querySelector('.modal');
const closeBtn = modal.querySelector('.close-btn');

showModalBtns.forEach(button => {
button.addEventListener('click', () => {
modal.style.display = 'block';
});
});

modal.addEventListener('click', (event) => {
if (event.target === modal || event.target === closeBtn) {
modal.style.display = 'none';
}
});

closeBtn.addEventListener('click', () => {
modal.classList.add('modal-close-animation');

modal.addEventListener('animationend', () => {
modal.classList.remove('modal-close-animation');
});
});
</script>

<!-- ======= footer ======= -->
<footer class="footer" style="margin-top: 50px;">
<div class="copyright">
<a href="#">&copy; Copyright <strong><span>UTRADE</span></strong>.</a>
</div>
</footer>

<a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>
<script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="assets/js/main.js"></script>

<!-- This script for the searchbox -->
<script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
<script>

const favoriteStocks = JSON.parse(localStorage.getItem('favoriteStocks')) || [];

// Function to save the favoriteStocks array to local storage
function saveFavoriteStocksToLocalStorage() {
localStorage.setItem('favoriteStocks', JSON.stringify(favoriteStocks));
}

function loadStockChart() {
var symbol = document.getElementById("symbolInput").value;

// Check if the input is empty
if (symbol.trim() === "") {
return; // Do nothing if the input is empty
}

var containerId = "tradingview";
new TradingView.widget({
"autosize": true,
"symbol": symbol,
"interval": "D",
"timezone": "Asia/Kuwait",
"theme": "light",
"style": "1",
"locale": "en",
"enable_publishing": false,
"allow_symbol_change": true,
"container_id": containerId
});

// Show the "Charts" div
document.querySelector(".previous_button").style.display = "block";
document.querySelector(".Charts").style.display = "block";

// Hide the "first" div
document.querySelector(".first").style.display = "none"; // No "first" class in your code
}

document.getElementById("symbolInput").addEventListener("keypress", function (e) {
if (e.key === "Enter") {
loadStockChart();
fetchTechStocks2();
}
});

document.getElementById("searchButton").addEventListener("click", loadStockChart);

//************************************************************************************************

// Function to format numbers in millions and billions
function formatNumber(num) {
if (num >= 1e9) {
    return (num / 1e9).toFixed(2) + 'B';
} else if (num >= 1e6) {
    return (num / 1e6).toFixed(2) + 'M';
} else if (num >= 1e3) {
    return (num / 1e3).toFixed(2) + 'k';
} else {
    return num;
}
}

// Function to fetch and display data from the API
function fetchTechStocks2() {
const apiKey = 'DZdHINhAKeEnsE6yDLBYFVI9lWOvPcLI';
const symbol = document.getElementById("symbolInput").value.toUpperCase();
const apiUrl = `https://financialmodelingprep.com/api/v3/quote-order/${symbol}?apikey=${apiKey}`;

// Fetch data from the API
fetch(apiUrl)
.then(response => response.json())
.then(data => {
    const stocks = data;

    const stocksTable = document.getElementById('stocks2');

    // Check if a row with the same symbol already exists
    const existingRow = stocksTable.querySelector(`tr[data-symbol="${symbol}"]`);

    if (existingRow) {
        // Update the existing row with new data
        console.log("if existingRow");
        
        const row = existingRow;
        var icon = "fa-heart-o";
        if (favoriteStocks.includes(symbol))
          icon = "fa-heart"
        row.innerHTML = `
            <td><img src="https://fmpcloud.io/image-stock/${stocks[0].symbol}.png" alt="${stocks[0].name}" onerror="this.style.display='none'" class="image-small"></td>
            <td><i class="fa ${icon} favorite-icon"></i></td>
            <td class="symbol dark-blue" style="font-weight: bold;"><span class="text-primary">${stocks[0].symbol}</span></td>
            <td>${stocks[0].name}</td>
            <td>$${formatNumber(stocks[0].marketCap)}</td>
            <td class="price" style="font-weight: bold;">$${stocks[0].price.toFixed(2)}</td>
            <td>${formatNumber(stocks[0].avgVolume)}</td>
        `;
    } else {
        // Create a new row and append it to the table
        const row = document.createElement('tr');
        row.dataset.symbol = symbol;
        var icon = "fa-heart-o";
        if (favoriteStocks.includes(symbol))
          icon = "fa-heart";
        row.innerHTML = `
            <td><img src="https://fmpcloud.io/image-stock/${stocks[0].symbol}.png" alt="${stocks[0].name}" onerror="this.style.display='none'" class="image-small"></td>
            <td><i class="fa ${icon} favorite-icon"></i></td>
            <td class="symbol dark-blue" style="font-weight: bold;"><span class="text-primary">${stocks[0].symbol}</span></td>
            <td>${stocks[0].name}</td>
            <td>$${formatNumber(stocks[0].marketCap)}</td>
            <td class="price" style="font-weight: bold;">$${stocks[0].price.toFixed(2)}</td>
            <td>${formatNumber(stocks[0].avgVolume)}</td>
        `;
        stocksTable.appendChild(row);
    }
})
.catch(error => console.error('Error fetching data:', error));
}

//Call the function to load data when the page loads
window.onload = function () {
//fetchTechStocks();
// Also, update the heart icons based on the stored favoriteStocks
updateFavoriteIcons();
};

document.getElementById("table2").addEventListener("click", function (event) {
  if (event.target.tagName === "I" && event.target.classList.contains("favorite-icon")) {
      // Toggle the favorite status when the heart icon is clicked
      const symbol = event.target.parentElement.nextElementSibling.textContent; // Get the stock symbol
      if (favoriteStocks.includes(symbol)) {
          // If already in favorites, remove it
          favoriteStocks.splice(favoriteStocks.indexOf(symbol), 1);
          event.target.classList.remove("fa-heart");
          event.target.classList.add("fa-heart-o");
      } else {
          // If not in favorites, add it
          favoriteStocks.push(symbol);
          event.target.classList.remove("fa-heart-o");
          event.target.classList.add("fa-heart");
      }
      updateFavoriteIcons();
      saveFavoriteStocksToLocalStorage();
  }
  console.log(favoriteStocks);
});

function updateFavoriteIcons() {
const favoriteIcons = document.querySelectorAll(".favorite-icon");
favoriteIcons.forEach(icon => {
    const symbol = icon.parentElement.nextElementSibling.textContent; // Get the stock symbol
    if (favoriteStocks.includes(symbol)) {
        icon.classList.remove("fa-heart-o");
        icon.classList.add("fa-heart");
    }
});
}

</script>

<script>
const showModalButtons = document.querySelectorAll('.show-modal-btn');
showModalButtons.forEach(button => {
button.addEventListener('click', function () {
    const target = this.getAttribute('data-target'); // Get the data-target value

    // Find the corresponding data for the clicked card and populate the modal
    var modalTitle, modalContent, symbols = [];
    if (target === 'software') {
        modalTitle = "Software stocks";
        modalContent = "This is a modal with software stock data.";
        symbols = ["AAPL", "MSFT", "GOOG", "AMZN", "NVDA","META", "TSLA", "BABA", "CRM", "AMD"];
    }
    else if (target === 'hardware') {
        modalTitle = "Hardware stocks";
        modalContent = "This is a modal with hardware stock data.";
        symbols = ["META", "TSLA", "BABA", "CRM", "AMD", "TSLA", "BABA", "CRM",];
    }
    else if (target === 'security') {
        modalTitle = "Security stocks";
        modalContent = "This is a modal with security stock data.";
        symbols = ["INTC", "ATVI", "PYPL","TSLA", "BABA", "CRM", "AMD"];
    }
    else if (target === 'telecommunication') {
        modalTitle = "Telecommunication stocks";
        modalContent = "This is a modal with telecommunication stock data.";
        symbols = ["TTD", "EA", "MTCH", "ZG", "YELP","TSLA", "BABA", "CRM", "AMD"];
    }
    else if (target === 'IT') {
        modalTitle = "IT services stocks";
        modalContent = "This is a modal with IT services stock data.";
        symbols = ["AMZN", "NVDA", "GOOG", "AMZN", "NVDA","TSLA", "BABA", "CRM", "AMD"];
    }
    else if (target === 'internet') {
        modalTitle = "Internet services stocks";
        modalContent = "This is a modal with IT Internet services stock data.";
        symbols = ["AAPL", "MSFT", "CRM", "AMD", "INTC","TSLA", "BABA", "CRM", "AMD"];
    }

    // Populate the modal with the data
    console.log(symbols);
    const modal = document.querySelector('.modal');
    const modalTitleElement = modal.querySelector('.modal-header h2');
    const modalContentElement = modal.querySelector('.modal-body');
    modalTitleElement.textContent = modalTitle;
    modalContentElement.innerHTML = `
    <div class="first">
    <div class="category">
      <div class="table-responsive">
        <table class="table table-striped" id="techStocks">
          <thead>
            <tr>
              <th>Logo</th>
              <th>Add to favorite</th>
              <th class="symbol">Symbol</th>
              <th>Company Name</th>
              <th>Market Cap</th>
              <th class="price">Last Price</th>
              <th>Avg Vol(3 month)</th>
            </tr>
          </thead>
          <tbody id="techStocksList"></tbody>
        </table>
      </div>
    </div>`;
    fetchTechStocks();

    // Function to fetch and display data from the API
function fetchTechStocks() {
  //api2 = "3JBiltvMdtCPcoO17Th2ZjUIUpKTTssH";
  //api3 = "DZdHINhAKeEnsE6yDLBYFVI9lWOvPcLI"
  const apiKey = '3JBiltvMdtCPcoO17Th2ZjUIUpKTTssH';
  const apiUrl = `https://financialmodelingprep.com/api/v3/quote-order/${symbols.join(",")}?apikey=${apiKey}`;

  // Fetch data from the API
  fetch(apiUrl)
    .then(response => response.json())
    .then(data => {
      const stocks = data;

      stocks.forEach(stock => {
        console.log(stock.name);
        const row = document.createElement('tr');
        row.innerHTML = `
            <td><img src="https://fmpcloud.io/image-stock/${stock.symbol}.png" alt="${stock.name}" onerror="this.style.display='none'" class="image-small"></td>
            <td><i class="fa ${favoriteStocks.includes(stock.symbol) ? 'fa-heart' : 'fa-heart-o'} favorite-icon"></i></td>
            <td class="symbol dark-blue" style="font-weight: bold;"><span class="text-primary">${stock.symbol}</span></td>
            <td>${stock.name}</td>
            <td>$${formatNumber(stock.marketCap)}</td>
            <td class="price" style="font-weight: bold;">$${stock.price.toFixed(2)}</td>
            <td>${formatNumber(stock.avgVolume)}</td>
        `;
        techStocksList.appendChild(row);
      });
    })
    .catch(error => console.error('Error fetching data:', error));
}

    // Show the modal
    modal.style.display = 'block';
});
});

// Function to close the modal
function closeModal() {
const modal = document.querySelector('.modal');
modal.style.display = 'none';
}

// Add an event listener to the modal's close button
const CloseBtn = document.querySelector('.close-btn');
CloseBtn.addEventListener('click', closeModal);
</script>

<script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="assets/js/main.js"></script>
</body>
</html>